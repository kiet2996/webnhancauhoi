<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Trang l∆∞u c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
 /* ===== TO√ÄN C·ª§C ===== */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'San Francisco', 'Roboto', sans-serif;
  margin: 40px;
  background-color: #f5f7fa;
  color: #2c3e50;
  line-height: 1.6;
}

/* ===== TI√äU ƒê·ªÄ ===== */
h2 {
  color: #1e293b;
  margin-bottom: 24px;
  font-size: 26px;
  font-weight: 700;
}

/* ===== PDF VIEWER ===== */
#pdfViewer {
  width: 100%;
  max-width: 800px;
  height: 520px;
  border: none;
  border-radius: 18px;
  margin-bottom: 30px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
}

/* ===== KH·ªêI C√ÇU H·ªéI ===== */
.qa-block {
  background: #ffffff;
  border: none;
  padding: 28px;
  margin-bottom: 36px;
  border-radius: 20px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
  transition: box-shadow 0.3s ease, transform 0.2s ease;
}

.qa-block:hover {
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
  transform: translateY(-3px);
}

/* ===== NH√ÉN ===== */
.qa-block label {
  font-weight: 600;
  display: block;
  margin-bottom: 10px;
  font-size: 16px;
  color: #1f2937;
}

/* ===== INPUT + TEXTAREA ===== */
.qa-block textarea,
.qa-block input[type="text"] {
  width: 100%;
  padding: 14px 16px;
  margin-bottom: 20px;
  border: 1px solid #d1d5db;
  border-radius: 14px;
  font-size: 15px;
  background-color: #f9fafb;
  transition: all 0.3s ease;
}

.qa-block textarea,
.qa-block input[type="text"] {
  width: 100%;
  box-sizing: border-box;
  resize: none;
  min-height: 40px;
  overflow: hidden;
}
/* ===== H√åNH ·∫¢NH ===== */
.qa-block img {
  max-width: 240px;
  margin-top: 16px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
}

/* ===== N√öT ===== */
button {
  padding: 14px 24px;
  margin-top: 10px;
  font-size: 16px;
  border: none;
  border-radius: 16px;
  cursor: pointer;
  background: linear-gradient(135deg, #4f46e5, #3b82f6);
  color: white;
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(59,130,246,0.3);
  transition: all 0.3s ease;
}

button:hover {
  opacity: 0.95;
  transform: translateY(-2px);
}



  </style>
</head>
<body>

<h2>Ch√†o m·ª´ng ƒë·∫øn v·ªõi b√†i thuy·∫øt tr√¨nh v·ªÅ" √î nhi·ªÖm m√¥i tr∆∞·ªùng "</h2>
<input type="file" id="pdfUpload" accept=".pdf">
<iframe id="pdfViewer"></iframe>

<h2>Danh s√°ch c√¢u h·ªèi & tr·∫£ l·ªùi</h2>
<div id="qaContainer"></div>

<button onclick="addQA()">‚ûï Th√™m khung c√¢u h·ªèi</button>
<button onclick="exportToWord()">üìù Xu·∫•t Word</button>
<button onclick="exportToPDF()">üìÑ Xu·∫•t PDF</button>
<button onclick="saveToJSON()">üíæ L∆∞u b·∫£n nh√°p</button>

<footer style="margin-top: 60px; text-align: center; font-size: 14px; color: #94a3b8;">
  ¬© 2025 B·∫£n quy·ªÅn thu·ªôc v·ªÅ <strong>Nguy·ªÖn Th·∫ø Ki·ªát</strong>
</footer>

<script src="dlkt/times-normal.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.0/html-docx.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.getElementById('pdfUpload').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const url = URL.createObjectURL(file);
  document.getElementById('pdfViewer').src = url;
});
function addQA() {
  const now = new Date().toLocaleString();
  const container = document.getElementById('qaContainer');

  const block = document.createElement('div');
  block.className = 'qa-block';
 block.innerHTML = `
  <label>Ng∆∞·ªùi h·ªèi: <input type="text" class="asker" /></label><br><br>
  <strong>Th·ªùi gian:</strong> <span class="time">${now}</span><br><br>
  <label>C√¢u h·ªèi:<br>
    <textarea class="question" rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
  </label><br><br>
  <label>Tr·∫£ l·ªùi:<br>
    <textarea class="answer" rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
  </label><br><br>
  <label>Ch√®n ·∫£nh: <input type="file" accept="image/*" class="imgInput" /></label><br>
  <img class="preview" />
`;

  container.appendChild(block);

  const imgInput = block.querySelector('.imgInput');
  const preview = block.querySelector('.preview');
  imgInput.addEventListener('change', function () {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

function exportToWord() {
  const blocks = document.querySelectorAll('.qa-block');
  let html = "<h2>Danh s√°ch c√¢u h·ªèi & tr·∫£ l·ªùi</h2>";

  blocks.forEach((block, index) => {
    const asker = block.querySelector('.asker')?.value || '';
    const time = block.querySelector('.time')?.innerText || '';
    const question = block.querySelector('.question')?.value || '';
    const answer = block.querySelector('.answer')?.value || '';
    const img = block.querySelector('.preview');

    html += `
      <div>
        <p><strong>Ng∆∞·ªùi h·ªèi:</strong> ${asker}</p>
        <p><strong>Th·ªùi gian:</strong> ${time}</p>
        <p><strong>C√¢u h·ªèi:</strong><br>${question.replace(/\n/g, "<br>")}</p>
        <p><strong>Tr·∫£ l·ªùi:</strong><br>${answer.replace(/\n/g, "<br>")}</p>
    `;

    if (img && img.src && img.src.startsWith('data:image')) {
      html += `<p><img src="${img.src}" style="max-width:200px;" /></p>`;
    }

    html += `</div><hr>`;
  });

  const content = `
    <!DOCTYPE html>
    <html>
    <head><meta charset='utf-8'></head>
    <body>${html}</body>
    </html>`;

  const blob = window.htmlDocx.asBlob(content);
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'QA.docx';
  link.click();
}

async function exportToPDF() {
  const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.addFileToVFS("times-normal.js", timenormal); // t·ª´ file .js sinh ra
doc.addFont("times.ttf", "times");
doc.setFont("times");

  let y = 10;

  const blocks = document.querySelectorAll('.qa-block');
  for (let i = 0; i < blocks.length; i++) {
    const block = blocks[i];
    const asker = block.querySelector('.asker')?.value || '';
    const time = block.querySelector('.time')?.innerText || '';
    const question = block.querySelector('.question')?.value || '';
    const answer = block.querySelector('.answer')?.value || '';
    const img = block.querySelector('.preview');

    doc.setFont("Helvetica", ""); // font h·ªó tr·ª£ c∆° b·∫£n ti·∫øng Vi·ªát
    doc.setFontSize(12);

    // T√°ch n·ªôi dung ƒë·ªÉ xu·ªëng d√≤ng n·∫øu d√†i
    y = writeMultilineText(doc, `Ng∆∞·ªùi h·ªèi: ${asker}`, 10, y);
    y = writeMultilineText(doc, `Th·ªùi gian: ${time}`, 10, y);
    y = writeMultilineText(doc, `C√¢u h·ªèi: ${question}`, 10, y);
    y = writeMultilineText(doc, `Tr·∫£ l·ªùi: ${answer}`, 10, y);

    // N·∫øu c√≥ ·∫£nh
    if (img && img.src && img.src.startsWith('data:image')) {
      const imgProps = doc.getImageProperties(img);
      const ratio = imgProps.width / imgProps.height;
      const imgWidth = 60;
      const imgHeight = imgWidth / ratio;

      if (y + imgHeight > 280) {
        doc.addPage();
        y = 10;
      }

      doc.addImage(img.src, 'JPEG', 10, y, imgWidth, imgHeight);
      y += imgHeight + 10;
    } else {
      y += 10;
    }

    if (y > 270 && i < blocks.length - 1) {
      doc.addPage();
      y = 10;
    }
  }

  doc.save('QA.pdf');
}

// H√†m h·ªó tr·ª£ vi·∫øt xu·ªëng d√≤ng t·ª± ƒë·ªông
function writeMultilineText(doc, text, x, y, maxWidth = 180, lineHeight = 7) {
  const lines = doc.splitTextToSize(text, maxWidth);
  lines.forEach(line => {
    doc.text(line, x, y);
    y += lineHeight;
  });
  return y;
}
function saveToJSON() {
  const blocks = document.querySelectorAll('.qa-block');
  const data = [];

  blocks.forEach(block => {
    data.push({
      "Ng∆∞·ªùi h·ªèi": block.querySelector('.asker')?.value || '',
      "Th·ªùi gian": block.querySelector('.time')?.innerText || '',
      "C√¢u h·ªèi": block.querySelector('.question')?.value || '',
      "C√¢u tr·∫£ l·ªùi": block.querySelector('.answer')?.value || '',
      "H√¨nh ·∫£nh": block.querySelector('.preview')?.src || ''
    });
  });

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'QA-data.json';
  link.click();
}

</script>

</body>
</html>
